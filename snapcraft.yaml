name: getcert
version: '0.1' # just for humans, typically '1.2+git' or '1.3.2'
summary: Installs/renews an Lets Encrypt certificate for the tomcat-with-ssl snap
description: | 
  Intended to use as a part for tomcat-with-ssl.
  Gets the required certificate automatically 
  managed by certbot (Lets Encrypt) including automatica renewals.
  Note: current if a renewal occurs tomcat will be restarted without warning.
  
parts: 

# certbot not available in standard repos so we need to add a repository
  setup-repo:
    plugin: nil
    prepare: |
      apt-get update --yes
      apt-get install --yes software-properties-common
      add-apt-repository --yes ppa:certbot/certbot
      apt-get update --yes
      apt-get install --yes certbot
 
  getcert:
    plugin: dump
    #source: snap/getcert
	source: https://github.com/bsutton/getcert.git
	source-type: git

    ## run our renew script as a certbot post renewal deploy script
    ## this installs the certs into the java keystore and restarts tomcat.
    #organize: 
      #renewal : letsencrypt/renewal-hooks/deploy
    after: [setup-repo]
    stage-packages:
      - certbot
      - libc6
      - libdb5.3

